<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="icon" type="image/png" href="/images/favicon-32x32.png">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-image: url(https://st.depositphotos.com/1152339/2229/i/950/depositphotos_22293887-stock-photo-networking-concept-silver-cloud-on.jpg);
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
        }

        section {
            position: relative;
            max-width: 500px;
            background-color: transparent;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px;
            backdrop-filter: blur(55px);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem 3rem;
            transition: all 0.5s ease-in-out;
        }

        h1 {
            font-size: 2rem;
            color: #fff;
            text-align: center;
        }

        .inputbox {
            position: relative;
            margin: 20px 0;
            max-width: 550px;
            border-bottom: 2px solid #fff;
            transition: all 0.5s ease-in-out;
        }

        .inputbox input {
            width: 100%;
            height: 40px;
            background: transparent;
            border: none;
            outline: none;
            font-size: 1rem;
            padding: 0 35px 0 5px;
            color: #fff;
        }

        .inputbox ion-icon {
            position: absolute;
            right: 8px;
            color: #fff;
            font-size: 1.2rem;
            top: 12px;
            transition: all 0.5s ease-in-out;
        }

        .inputbox label {
            position: absolute;
            top: 50%;
            left: 5px;
            transform: translateY(-50%);
            color: #fff;
            font-size: 1rem;
            pointer-events: none;
            transition: all 0.5s ease-in-out;
        }

        input:focus~label,
        input:valid~label {
            top: -5px;
            font-size: 0.9rem;
            color: #a8a8a8;
        }

        button {
            width: 100%;
            height: 40px;
            border-radius: 40px;
            background-color: rgba(255, 255, 255, 1);
            border: none;
            outline: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.4s ease;
        }

        button:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .register {
            font-size: 0.9rem;
            color: #fff;
            text-align: center;
            margin: 25px 0 10px;
            transition: all 0.5s ease-in-out;
        }

        .register p a {
            text-decoration: none;
            color: #fff;
            font-weight: 600;
            transition: all 0.5s ease-in-out;
        }

        .register p a:hover {
            text-decoration: underline;
            color: #a8a8a8;
        }

        /* Shake animation for invalid form submission */
        @keyframes shake {
            0% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            50% {
                transform: translateX(10px);
            }

            75% {
                transform: translateX(-10px);
            }

            100% {
                transform: translateX(0);
            }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        
        
		.success-message {
		    position: fixed;
		    top: 50px;
		    left: 50%;
		    transform: translateX(-50%);
		    width: 20%;
		    max-width: 500px;
		    padding: 15px;
		    border-radius: 5px;
		    background-color: #d4edda;
		    color: #155724;
		    border: 1px solid #c3e6cb;
		    font-weight: bold;
		    display: flex; /* Flex container */
		    align-items: center; /* Dikeyde ortalar */
		    justify-content: center; /* Yatayda ortalar */
		    height: 70px; /* Yükseklik belirledim */
		    z-index: 1000;
		    text-align: center; /* Metni yatayda ortalar */
		}

		.success-message ion-icon {
		    font-size: 24px;
		    margin-right: 10px; /* İkon ile metin arasında boşluk bırakır */
		    display: inline-block; /* İkonu satırda göster */
			margin-top:8px;
		}

		.success-message p {
		    margin: 0; /* Paragrafın etrafındaki varsayılan boşluğu kaldırır */
		    display: inline; /* Mesajı satır içinde tutar */
		    position: relative; /* Relative konumlandırma */
		    top: -5px; /* Mesajı biraz yukarı kaydırır */
		}



		
		#error-message {
		    position: fixed;
		    top: 50px;
		    border-radius:30px;
		    width: 30%;
		    padding: 15px;
		    text-align: center;
		    background-color: red;
		    color: white;
		    font-weight: bold;
		    display: none;
		    z-index: 1000;
		}

    </style>
</head>

<body>
	<!-- Başarı mesajı div'i formdan önce yerleştirildi -->
	<div id="success-message" class="success-message">
	    <ion-icon name="checkmark-circle"></ion-icon>
	    <p>Başarıyla çıkış yapıldı.</p>
	</div>

	<div id="error-message" class="error" style="display: none;">
	    <p id="error-text"></p>
	</div>



	   <section>
	        <form id="loginForm" action="/perform_login" method="post">
	            <h1>Login</h1>
	            <div class="inputbox">
	                <ion-icon name="person-outline"></ion-icon>
	                <input name="username" id="username" type="text" required>
	                <label for="username">Username</label>
	            </div>
	            <div class="inputbox">
	                <ion-icon name="lock-closed-outline"></ion-icon>
	                <input name="password" type="password" id="password" required>
	                <label for="password">Password</label>
	            </div>
	            <div class="register">
	                <p><a href="/forget_password">Forget Password</a></p>
	            </div>
	            <button type="submit">Log in</button>
	            <div class="register">
	                <p>Don't have an account? <a href="/req/signup">Register!!</a></p>
	            </div>
	        </form>
	    </section>
	
	<script>
		document.addEventListener('DOMContentLoaded', function () {
		            const urlParams = new URLSearchParams(window.location.search);
		            const errorMessageDiv = document.getElementById('error-message');
					const errorText = document.getElementById('error-text');
					const successMessageDiv = document.getElementById('success-message');


		            if (urlParams.has('error')) {
						errorText.innerText = "Giriş başarısız! Lütfen bilgilerinizi kontrol edin.";
		                errorMessageDiv.style.display = 'block';
		            }
					
					if (urlParams.has('logout')) {
					    successMessageDiv.style.display = 'block';
					    setTimeout(() => {
					        successMessageDiv.style.display = 'none';
					    }, 2000); // 2 saniye sonra kaybolacak
					} else {
					    successMessageDiv.style.display = 'none'; // Eğer 'logout' yoksa, başarı mesajı gizlensin
					}

					

		            // Login formunun submit işlemi
		            const loginForm = document.querySelector('#loginForm');
		            loginForm.addEventListener('submit', async function (event) {
		                event.preventDefault();

		                const formData = new FormData(loginForm);

		                try {
		                    const response = await fetch("/perform_login", {
		                        method: "POST",
		                        body: formData,
		                        credentials: "include"
		                    });

		                    if (response.redirected) {
		                        // Giriş başarılı, userId'yi al
		                        const userIdResponse = await fetch("/auth/loginSuccess", {
		                            method: "POST",
		                            credentials: "include"
		                        });

		                        if (userIdResponse.ok) {
		                            const userId = await userIdResponse.text();
		                            console.log("Backend'ten gelen userId:", userId);
		                            
		                            localStorage.setItem("userId", userId);
		                            console.log("Giriş başarılı, Kullanıcı ID:", userId);

		                            // Kullanıcıyı yönlendir
		                            window.location.href = response.url;
		                        } else {
		                            console.error("Kullanıcı ID alınamadı.");
		                            window.location.replace("/loginPage?error=true");
		                        }
		                    } else {
		                        console.error("Giriş başarısız.");
		                        window.location.replace("/loginPage?error=true");
		                    }
		                } catch (error) {
		                    console.error("Bağlantı hatası:", error);
		                    window.location.replace("/loginPage?error=true");
		                }
		            });
		        });
				
				// Sayfa yüklendiğinde çalışacak kod
				window.onload = function() {
				    // URL parametresi "logout" olup olmadığını kontrol et
				    const urlParams = new URLSearchParams(window.location.search);
				    
				    // Eğer URL'de "logout" parametresi varsa
				    if (urlParams.has('logout')) {
				        // localStorage'dan userId'yi sil
				        localStorage.removeItem('userId');
				        
				        // Çıkış işlemi sonrası kullanıcıyı yönlendirebilirsiniz
				        window.location.href = '/loginPage'; // Veya ana sayfaya yönlendirme yapabilirsiniz
				    }
				};

	    </script>
</body>

</html>







